{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "Pine Script",
  "scopeName": "source.pinescript",
  "patterns": [
    {
      "include": "#comments"
    },
    {
      "include": "#strings"
    },
    {
      "include": "#numbers"
    },
    {
      "include": "#version"
    },
    {
      "include": "#annotations"
    },
    {
      "include": "#keywords"
    },
    {
      "include": "#types"
    },
    {
      "include": "#constants"
    },
    {
      "include": "#namespaces"
    },
    {
      "include": "#operators"
    },
    {
      "include": "#functions"
    },
    {
      "include": "#variables"
    }
  ],
  "repository": {
    "comments": {
      "patterns": [
        {
          "name": "comment.line.double-slash.pinescript",
          "match": "//.*$"
        }
      ]
    },
    "version": {
      "patterns": [
        {
          "name": "meta.preprocessor.pinescript",
          "match": "^//@version=\\d+"
        }
      ]
    },
    "annotations": {
      "patterns": [
        {
          "name": "meta.annotation.pinescript",
          "match": "^//(@description|@param|@returns|@type|@function|@variable|@field).*$"
        }
      ]
    },
    "strings": {
      "patterns": [
        {
          "name": "string.quoted.double.pinescript",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            {
              "name": "constant.character.escape.pinescript",
              "match": "\\\\."
            }
          ]
        },
        {
          "name": "string.quoted.single.pinescript",
          "begin": "'",
          "end": "'",
          "patterns": [
            {
              "name": "constant.character.escape.pinescript",
              "match": "\\\\."
            }
          ]
        }
      ]
    },
    "numbers": {
      "patterns": [
        {
          "name": "constant.numeric.hex.pinescript",
          "match": "#[0-9A-Fa-f]{6,8}\\b"
        },
        {
          "name": "constant.numeric.pinescript",
          "match": "\\b[0-9]+(\\.[0-9]+)?\\b"
        }
      ]
    },
    "keywords": {
      "patterns": [
        {
          "name": "keyword.control.pinescript",
          "match": "\\b(if|else|for|to|while|switch|case|default|break|continue|return|import|export)\\b"
        },
        {
          "name": "keyword.declaration.pinescript",
          "match": "\\b(var|varip|const|type|method|enum)\\b"
        },
        {
          "name": "storage.type.function.pinescript",
          "match": "\\b(indicator|strategy|library)\\b"
        },
        {
          "name": "keyword.other.pinescript",
          "match": "\\b(and|or|not)\\b"
        }
      ]
    },
    "types": {
      "patterns": [
        {
          "name": "support.type.pinescript",
          "match": "\\b(int|float|bool|string|color|label|line|box|table|array|matrix|map|polyline|chart\\.point)\\b"
        },
        {
          "name": "storage.modifier.pinescript",
          "match": "\\b(series|simple|const|input)\\b"
        }
      ]
    },
    "constants": {
      "patterns": [
        {
          "name": "constant.language.pinescript",
          "match": "\\b(true|false|na)\\b"
        },
        {
          "name": "constant.language.color.pinescript",
          "match": "\\bcolor\\.(aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow)\\b"
        },
        {
          "name": "constant.language.extend.pinescript",
          "match": "\\bextend\\.(none|left|right|both)\\b"
        },
        {
          "name": "constant.language.xloc.pinescript",
          "match": "\\bxloc\\.(bar_index|bar_time)\\b"
        },
        {
          "name": "constant.language.yloc.pinescript",
          "match": "\\byloc\\.(price|abovebar|belowbar)\\b"
        },
        {
          "name": "constant.language.size.pinescript",
          "match": "\\bsize\\.(auto|tiny|small|normal|large|huge)\\b"
        },
        {
          "name": "constant.language.barmerge.pinescript",
          "match": "\\bbarmerge\\.(gaps_on|gaps_off|lookahead_on|lookahead_off)\\b"
        },
        {
          "name": "constant.language.adjustment.pinescript",
          "match": "\\badjustment\\.(none|splits|dividends)\\b"
        }
      ]
    },
    "namespaces": {
      "patterns": [
        {
          "name": "support.class.pinescript",
          "match": "\\b(ta|math|str|array|matrix|map|request|ticker|timeframe|syminfo|barstate|chart|session|strategy|input|alert|runtime|log|box|label|line|linefill|table|polyline|color)\\b(?=\\.)"
        }
      ]
    },
    "operators": {
      "patterns": [
        {
          "name": "keyword.operator.assignment.pinescript",
          "match": ":=|="
        },
        {
          "name": "keyword.operator.arrow.pinescript",
          "match": "=>"
        },
        {
          "name": "keyword.operator.ternary.pinescript",
          "match": "\\?|:"
        },
        {
          "name": "keyword.operator.comparison.pinescript",
          "match": "==|!=|<=|>=|<|>"
        },
        {
          "name": "keyword.operator.arithmetic.pinescript",
          "match": "\\+|-|\\*|/|%"
        }
      ]
    },
    "functions": {
      "patterns": [
        {
          "name": "entity.name.function.pinescript",
          "match": "\\b([a-zA-Z_][a-zA-Z0-9_]*)\\s*(?=\\()"
        }
      ]
    },
    "variables": {
      "patterns": [
        {
          "name": "variable.language.builtin.pinescript",
          "match": "\\b(open|high|low|close|volume|time|time_close|hl2|hlc3|hlcc4|ohlc4|bar_index|last_bar_index|last_bar_time|timenow)\\b"
        },
        {
          "name": "variable.other.pinescript",
          "match": "\\b[a-zA-Z_][a-zA-Z0-9_]*\\b"
        }
      ]
    }
  }
}